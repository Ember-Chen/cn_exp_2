(function(){"use strict";var e={8928:function(e,t,n){n.d(t,{B$:function(){return a},Gk:function(){return r},IS:function(){return l}});var o=n(4870),r="cjy";function l(e){r=e}const s="ws://127.0.0.1:8080/websocket-server/";class i{constructor(){this.socket=(0,o.iH)(null)}connect(){const e=s+r;this.socket.value=new WebSocket(e),this.socket.value.onopen=()=>{console.log("WebSocket connection opened")},this.socket.value.onclose=e=>{console.log("WebSocket connection closed:",e)},this.socket.value.onerror=e=>{console.error("WebSocket error:",e)}}getSocket(){return this.socket.value}close(){this.socket.value.close()}}const a=new i},7357:function(e,t,n){var o=n(9242),r=n(3396);const l={id:"app"};function s(e,t,n,o,s,i){const a=(0,r.up)("router-view");return(0,r.wg)(),(0,r.iD)("div",l,[e.$route.meta.KeepAlive?((0,r.wg)(),(0,r.j4)(r.Ob,{key:0},[(0,r.Wm)(a)],1024)):((0,r.wg)(),(0,r.j4)(a,{key:1}))])}var i=n(2483),a=(0,r.aZ)({name:"App",setup(){const e=(0,i.yj)();return{$route:e}}}),u=n(89);const c=(0,u.Z)(a,[["render",s]]);var d=c,p=n(4239),f=(n(4415),n(5867)),m=n(5503),g=(n(5110),n(8928));const h=(0,o.ri)(d);h.config.productionTip=!1;const y=n(5743);h.config.globalProperties.dayjs=y,h.use(g.B$),h.config.globalProperties.socketManager=g.B$,h.use(f.Z),h.use(p.Z),h.use(m.ZPm),h.mount("#app")},4239:function(e,t,n){n.d(t,{Z:function(){return $}});var o=n(3396),r=n(7139),l=n(9242);const s={style:{display:"flex","margin-top":"50px"}},i={style:{"margin-right":"10px","margin-left":"10px","margin-top":"20px","font-size":"20px"}},a={class:"toolbar"},u={style:{"margin-right":"10px","margin-left":"10px"}},c={key:0,style:{"margin-left":"10px","margin-bottom":"8px"}},d={style:{"margin-left":"10px"}},p={key:1,style:{"margin-right":"10px","margin-bottom":"8px"}},f={style:{"margin-right":"10px"}};function m(e,t,n,m,g,h){const y=(0,o.up)("message"),v=(0,o.up)("el-icon"),w=(0,o.up)("el-menu-item"),k=(0,o.up)("el-menu-item-group"),_=(0,o.up)("el-sub-menu"),b=(0,o.up)("icon-menu"),x=(0,o.up)("el-menu"),E=(0,o.up)("el-input"),S=(0,o.up)("el-button"),W=(0,o.up)("el-scrollbar"),C=(0,o.up)("el-aside"),L=(0,o.up)("el-avatar"),j=(0,o.up)("el-header"),M=(0,o.up)("el-row"),T=(0,o.up)("el-col"),A=(0,o.up)("el-main"),O=(0,o.up)("el-container");return(0,o.wg)(),(0,o.j4)(O,{class:"layout-container-demo",style:{height:"500px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(C,{width:"200px"},{default:(0,o.w5)((()=>[(0,o.Wm)(W,{style:{display:"flex"}},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{"default-openeds":["1","2"]},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{index:"1"},{title:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y)])),_:1}),(0,o.Uk)("联系人 ")])),default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(h.filteredUserList,(e=>((0,o.wg)(),(0,o.j4)(k,{key:e.idx},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{index:String(e),onClick:h.handleSelectUser,style:{height:"40px"}},{default:(0,o.w5)((()=>[(0,o.Uk)((0,r.zw)(e),1)])),_:2},1032,["index","onClick"])])),_:2},1024)))),128))])),_:1}),(0,o.Wm)(_,{index:"2"},{title:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b)])),_:1}),(0,o.Uk)("群组 ")])),default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(g.groupList,(e=>((0,o.wg)(),(0,o.j4)(k,{key:e.idx},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{index:String(e),onClick:h.handleSelectGroup},{default:(0,o.w5)((()=>[(0,o.Uk)((0,r.zw)(e),1)])),_:2},1032,["index","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),(0,o._)("div",s,[(0,o.Wm)(E,{type:"text",style:{width:"100%"},autofocus:"",onKeyup:(0,l.D2)(h.addGroup,["enter"]),placeholder:"输入群号",modelValue:g.groupToAdd,"onUpdate:modelValue":t[0]||(t[0]=e=>g.groupToAdd=e)},null,8,["onKeyup","modelValue"]),(0,o.Wm)(S,{onClick:h.addGroup,type:"primary",align:"middle",size:"default",sy:""},{default:(0,o.w5)((()=>[(0,o.Uk)(" 加入群组 ")])),_:1},8,["onClick"])])])),_:1})])),_:1}),(0,o.Wm)(O,null,{default:(0,o.w5)((()=>[(0,o.Wm)(j,{style:{"font-size":"12px",display:"flex","flex-direction":"row","justify-content":"space-between"}},{default:(0,o.w5)((()=>[(0,o._)("div",i," 当前聊天:"+(0,r.zw)(g.target),1),(0,o._)("div",a,[(0,o._)("div",null,[(0,o.Wm)(S,{onClick:h.cls,size:"default"},{default:(0,o.w5)((()=>[(0,o.Uk)(" 清空输入框 ")])),_:1},8,["onClick"]),(0,o._)("span",u,(0,r.zw)(g.username),1),(0,o.Wm)(L,{size:"default",fit:"fit"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,r.zw)(g.username),1)])),_:1})])])])),_:1}),(0,o.Wm)(A,{style:{"margin-top":"1px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(W,{class:"chat-room",id:"chat-room",ref:"chatRoom",style:{"margin-top":"1px"},always:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(g.msgList,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.content,ref_for:!0,ref:"innerRef",style:{"margin-top":"10px","margin-bottom":"20px"}},[t.local?((0,o.wg)(),(0,o.iD)("div",p,[(0,o.Wm)(M,{class:"row-bg",type:"flex",justify:"end",align:"middle"},{default:(0,o.w5)((()=>[(0,o._)("span",f,(0,r.zw)(e.dayjs(t.time).format("YYYY-MM-DD HH:mm")),1),(0,o.Wm)(L,{size:"default",fit:"fit"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Me ")])),_:1})])),_:2},1024),(0,o.Wm)(M,{justify:"end"},{default:(0,o.w5)((()=>[(0,o.Wm)(T,{span:1e3,class:"msg2",style:{"margin-right":"20px"}},{default:(0,o.w5)((()=>[(0,o.Uk)((0,r.zw)(t.content),1)])),_:2},1024)])),_:2},1024)])):((0,o.wg)(),(0,o.iD)("div",c,[(0,o.Wm)(M,{class:"row-bg",type:"flex",align:"middle"},{default:(0,o.w5)((()=>[(0,o.Wm)(L,{size:"default",fit:"fit"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,r.zw)(t.source),1)])),_:2},1024),(0,o._)("span",d,(0,r.zw)(e.dayjs(t.time).format("YYYY-MM-DD HH:mm")),1)])),_:2},1024),(0,o.Wm)(M,null,{default:(0,o.w5)((()=>[(0,o.Wm)(T,{span:1e3,offset:1,class:"msg"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,r.zw)(t.content),1)])),_:2},1024)])),_:2},1024)]))])))),128))])),_:1},512)])),_:1}),(0,o.Wm)(M,{class:"row-bg",type:"flex",justify:"space-around",align:"middle"},{default:(0,o.w5)((()=>[(0,o.Wm)(T,{span:20},{default:(0,o.w5)((()=>[(0,o.Wm)(E,{disable:!0,type:"text",style:{width:"100%"},autofocus:"",onKeyup:(0,l.D2)(h.handleSendBtnClick,["enter"]),placeholder:"请输入消息按Enter发送",modelValue:g.currentMsg,"onUpdate:modelValue":t[1]||(t[1]=e=>g.currentMsg=e)},null,8,["onKeyup","modelValue"])])),_:1}),(0,o.Wm)(T,{span:2},{default:(0,o.w5)((()=>[(0,o.Wm)(S,{class:"sendBtn",onClick:h.handleSendBtnClick,type:"primary",size:"default"},{default:(0,o.w5)((()=>[(0,o.Uk)(" 发送 ")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})}n(560);var g=n(9119),h=n(1015),y=n(3293),v=n(243),w=n(9776),k=n(4902),_=n(2261),b=n(2748),x=n(8928),E=n(4870),S=n(2483),W=n(6e3);let C;var L={setup(){const e=(0,E.iH)(null);(0,S.tv)();return x.B$.connect(),C=(0,E.iH)(x.B$.getSocket()).value,console.log("------------------"),console.log(C),console.log("------------------"),{innerRef:e,ws:C}},name:"Home",components:{ElAvatar:g.vs,ElIcon:h.gn,ElMenu:y.Q8,ElMenuItem:y.E_,ElMenuItemGroup:y.EQ,ElScrollbar:v.Mr,IconMenu:b.v2r,Message:b.v0C,Setting:b.pEs,ElRow:w.dq,ElCol:k.Dv,ElButton:_.ElButton},data(){return{max:0,type:"invalid",target:null,currentMsg:"",username:x.Gk,groupToAdd:null,contentHeight:490,chatRoom:null,userList:[],groupList:[],msgList:[]}},mounted(){const e=e=>{console.log("websocket open 连接成功")},t=e=>{console.log("websocket close 关闭连接")},n=e=>{console.log("websocket error 连接错误",e)},o=e=>{let t=JSON.parse(e.data);if(console.log("websocket message 服务器消息",t),null==t.type)consolo.log("valid");else if("update_group"==t.type)this.groupList=t.content.split("^");else if("update_user"==t.type)this.userList=t.content.split("^");else if("side_txt"==t.type){if(console.log("消息来自",t.source,"内容为",t.content),t.source==x.Gk)return;this.msgList.push(t)}else"group_txt"==t.type&&(console.log("群聊消息来自",t.source,"内容为",t.content),this.msgList.push(t));this.$nextTick((()=>{document.querySelector("#chat-room")}))};C.addEventListener("open",e,!1),C.addEventListener("close",t,!1),C.addEventListener("error",n,!1),C.addEventListener("message",o,!1),this.chatRoom=this.$refs.chatRoom,console.log("this.chatRoom",this.chatRoom)},computed:{filteredUserList(){return this.userList}},watch:{msgList:{handler(){this.$nextTick((()=>{this.updateMax(),this.scrollToBottom()}))},deep:!0}},methods:{updateMax(){if(this.innerRef){const e=Object.keys(this.innerRef).length;console.log("msgList Size:",e),this.max=100*e+1e3}},scrollToBottom(){const e=this.$refs.chatRoom;e.setScrollTop(this.max)},handleSendBtnClick(){const e=this.currentMsg;if(!e.trim().length)return void W.T.alert("消息为空，无法发送","错误");if("invalid"==this.type)return void W.T.alert("未选择联系人，无法发送","错误");let t;if("side_txt"==this.type)t={type:this.type,source:x.Gk,target:this.target,content:e,local:!0};else{if("group_txt"!=this.type)return void console.log("非法发送信息尝试");t={type:this.type,group_id:this.target,content:e,local:!0}}C.send(JSON.stringify(t)),this.msgList.push(t),this.currentMsg=""},handleSelectUser(e){this.type="side_txt",this.target=e.index,console.log("当前target",this.target,"当前发送类型",this.type)},handleSelectGroup(e){this.type="group_txt",this.target=e.index,console.log("当前target",this.target,"当前发送类型",this.type)},addGroup(){const e=this.groupToAdd;if(console.log(e),null==e)return;let t={type:"add_group",group_id:e};C.send(JSON.stringify(t)),this.groupList.push(e),this.groupToAdd=null},cls(){this.msgList=[]}}},j=n(89);const M=(0,j.Z)(L,[["render",m],["__scopeId","data-v-85cde8f8"]]);var T=M;const A=e=>((0,o.dD)("data-v-4151e73e"),e=e(),(0,o.Cn)(),e),O=A((()=>(0,o._)("header",{class:"header"},[(0,o._)("h1",null,"用户管理系统")],-1))),U={class:"avatar-group"};function z(e,t,n,l,s,i){const a=(0,o.up)("el-button"),u=(0,o.up)("el-aside"),c=(0,o.up)("el-avatar"),d=(0,o.up)("el-main"),p=(0,o.up)("el-container");return(0,o.wg)(),(0,o.j4)(p,{class:"admin-panel"},{default:(0,o.w5)((()=>[O,(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,{width:"200px",class:"aside"},{default:(0,o.w5)((()=>[(0,o.Wm)(a,{type:"danger",onClick:i.kick,class:"kick-button"},{default:(0,o.w5)((()=>[(0,o.Uk)("踢出成员")])),_:1},8,["onClick"])])),_:1}),(0,o.Wm)(d,{class:"main"},{default:(0,o.w5)((()=>[(0,o._)("div",U,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.userList,(e=>((0,o.wg)(),(0,o.j4)(c,{key:e.idx,size:"large",class:"avatar",onClick:t=>i.selectUser(e)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,r.zw)(e),1)])),_:2},1032,["onClick"])))),128))])])),_:1})])),_:1})])),_:1})}let B;var D={setup(){const e=(0,E.iH)(null);(0,S.tv)();return(0,x.IS)("ADMIN"),console.log(x.Gk),x.B$.connect(),B=(0,E.iH)(x.B$.getSocket()).value,console.log("------------------"),console.log(B),console.log("------------------"),{innerRef:e,ws:B}},name:"Admin",components:{ElAvatar:g.vs,ElIcon:h.gn,ElMenu:y.Q8,ElMenuItem:y.E_,ElMenuItemGroup:y.EQ,ElScrollbar:v.Mr,IconMenu:b.v2r,Message:b.v0C,Setting:b.pEs,ElRow:w.dq,ElCol:k.Dv,ElButton:_.ElButton},data(){return{userList:[],target:null}},mounted(){const e=e=>{console.log("websocket open 连接成功");let t={type:"update_user"};B.send(JSON.stringify(t))},t=e=>{console.log("websocket close 关闭连接")},n=e=>{console.log("websocket error 连接错误",e)},o=e=>{let t=JSON.parse(e.data);if(console.log("websocket message 服务器消息",t),"update_user"==t.type){const e=t.content;this.userList="^"==e?[]:t.content.split("^")}};B.addEventListener("open",e,!1),B.addEventListener("close",t,!1),B.addEventListener("error",n,!1),B.addEventListener("message",o,!1),this.chatRoom=this.$refs.chatRoom,console.log("this.chatRoom",this.chatRoom)},methods:{changeCursor(){document.body.style.cursor="pointer"},selectUser(e){const t=e;this.target=t,console.log(this.target)},kick(){const e=this.target;if(null==e)return void W.T.alert("未选择成员","错误");console.log(e);let t={type:"exile",target:e};B.send(JSON.stringify(t)),W.T.alert("已踢出该成员","成功")}}};const R=(0,j.Z)(D,[["render",z],["__scopeId","data-v-4151e73e"]]);var H=R;const N=[{path:"/home",name:"Home",component:T,meta:{keepAlive:!0}},{path:"/",name:"Login",meta:{keepAlive:!1},component:()=>n.e(991).then(n.bind(n,8991))},{path:"/admin",name:"Admin",component:H}],I=new S.p7({history:(0,S.r5)(),routes:N});var $=I}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var l=t[o]={exports:{}};return e[o].call(l.exports,l,l.exports,n),l.exports}n.m=e,function(){var e=[];n.O=function(t,o,r,l){if(!o){var s=1/0;for(c=0;c<e.length;c++){o=e[c][0],r=e[c][1],l=e[c][2];for(var i=!0,a=0;a<o.length;a++)(!1&l||s>=l)&&Object.keys(n.O).every((function(e){return n.O[e](o[a])}))?o.splice(a--,1):(i=!1,l<s&&(s=l));if(i){e.splice(c--,1);var u=r();void 0!==u&&(t=u)}}return t}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[o,r,l]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,o){return n.f[o](e,t),t}),[]))}}(),function(){n.u=function(e){return"js/"+e+".63421aa5.js"}}(),function(){n.miniCssF=function(e){return"css/"+e+".413cb112.css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="chat-websocket:";n.l=function(o,r,l,s){if(e[o])e[o].push(r);else{var i,a;if(void 0!==l)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==o||d.getAttribute("data-webpack")==t+l){i=d;break}}i||(a=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,n.nc&&i.setAttribute("nonce",n.nc),i.setAttribute("data-webpack",t+l),i.src=o),e[o]=[r];var p=function(t,n){i.onerror=i.onload=null,clearTimeout(f);var r=e[o];if(delete e[o],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach((function(e){return e(n)})),t)return t(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=p.bind(null,i.onerror),i.onload=p.bind(null,i.onload),a&&document.head.appendChild(i)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p=""}(),function(){if("undefined"!==typeof document){var e=function(e,t,n,o,r){var l=document.createElement("link");l.rel="stylesheet",l.type="text/css";var s=function(n){if(l.onerror=l.onload=null,"load"===n.type)o();else{var s=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.href||t,a=new Error("Loading CSS chunk "+e+" failed.\n("+i+")");a.code="CSS_CHUNK_LOAD_FAILED",a.type=s,a.request=i,l.parentNode&&l.parentNode.removeChild(l),r(a)}};return l.onerror=l.onload=s,l.href=t,n?n.parentNode.insertBefore(l,n.nextSibling):document.head.appendChild(l),l},t=function(e,t){for(var n=document.getElementsByTagName("link"),o=0;o<n.length;o++){var r=n[o],l=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(l===e||l===t))return r}var s=document.getElementsByTagName("style");for(o=0;o<s.length;o++){r=s[o],l=r.getAttribute("data-href");if(l===e||l===t)return r}},o=function(o){return new Promise((function(r,l){var s=n.miniCssF(o),i=n.p+s;if(t(s,i))return r();e(o,i,null,r,l)}))},r={143:0};n.f.miniCss=function(e,t){var n={991:1};r[e]?t.push(r[e]):0!==r[e]&&n[e]&&t.push(r[e]=o(e).then((function(){r[e]=0}),(function(t){throw delete r[e],t})))}}}(),function(){var e={143:0};n.f.j=function(t,o){var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)o.push(r[2]);else{var l=new Promise((function(n,o){r=e[t]=[n,o]}));o.push(r[2]=l);var s=n.p+n.u(t),i=new Error,a=function(o){if(n.o(e,t)&&(r=e[t],0!==r&&(e[t]=void 0),r)){var l=o&&("load"===o.type?"missing":o.type),s=o&&o.target&&o.target.src;i.message="Loading chunk "+t+" failed.\n("+l+": "+s+")",i.name="ChunkLoadError",i.type=l,i.request=s,r[1](i)}};n.l(s,a,"chunk-"+t,t)}},n.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,l,s=o[0],i=o[1],a=o[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(r in i)n.o(i,r)&&(n.m[r]=i[r]);if(a)var c=a(n)}for(t&&t(o);u<s.length;u++)l=s[u],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(c)},o=self["webpackChunkchat_websocket"]=self["webpackChunkchat_websocket"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(7357)}));o=n.O(o)})();
//# sourceMappingURL=app.f762eaba.js.map